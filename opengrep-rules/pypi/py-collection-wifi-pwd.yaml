rules:
  - id: py-collection-wifi-pwd
    languages:
      - python
    options:
      symbolic_propagation: true
    patterns:
      # Catch different modules for calling OS processes
      - pattern-either:
        - pattern: subprocess.$FUNC(..., $CMD, ...)
        - pattern: os.$FUNC(..., $CMD, ...)
        - pattern: popen2.$FUNC(..., $CMD, ...)
      # The regex is necessary to catch strings also if they have prefixes (b, f, u, r), slices or % expressions
      - metavariable-regex:
          metavariable: $CMD
          regex: (?msi)^(b|f|u|r|B|F|U|R)?['\"]{1,3}.*netsh wlan show.*key=clear.*['\"]{1,3}(\[[\d\-:]+\])?.*%?.*$
    message: The file accesses Wifi passwords in clear text.
    severity: INFO
    metadata:
      version: latest
      confidence: LOW
      endor-targets:
        - ENDOR_TARGET_PACKAGE
      endor-category: malware-detection
      endor-tags:
        - ANALYTICS_IGNORE
      endor-attack-examples:
        - https://socket.dev/blog/blank-grabber-python-package-steals-info-from-discord-and-telegram
