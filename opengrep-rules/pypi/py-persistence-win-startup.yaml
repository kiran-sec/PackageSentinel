rules:
  - id: py-persistence-win-startup
    languages:
      - python
    mode: taint
    options:
      symbolic_propagation: true
    pattern-sources:
      - patterns:
        - pattern-either:
          - pattern: $VAR = $STR
          - pattern: $VAR = [..., $STR, ...]
          - pattern: $FUNC(..., $STR, ...)
          - pattern: $FUNC(..., [..., $STR, ...], ...)
          - pattern: |
              {..., $KEY: $STR, ...}
        - metavariable-regex:
            metavariable: $STR
            regex: (?msi)^(b|f|u|r|B|F|U|R)?['\"]{1,3}.*(StartUp).*['\"]{1,3}(\[[\d\-:]+\])?$
    pattern-sinks:
      - pattern: os.makedirs(...)
    message: A new folder is created in the startup folder, which contains programs starting automatically under Windows.
    severity: INFO
    metadata:
      version: latest
      confidence: LOW
      endor-targets:
        - ENDOR_TARGET_PACKAGE
      endor-category: malware-detection
      endor-tags:
        - ANALYTICS_IGNORE
      endor-attack-examples:
        - https://socket.dev/blog/blank-grabber-python-package-steals-info-from-discord-and-telegram
